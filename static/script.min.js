function stop_loading(){$("#preload").fadeOut("fast")}$(document).ready((function(){var state_names=[],total_confirmed=[],total_active=[],total_recovered=[];const time_series_url="https://api.covid19tracker.in/data/static/timeseries.min.json",url="https://api.covid19tracker.in/data/static/data.min.json",date_url="https://api.covid19tracker.in/data/static/data/2021-11-03.min.json",state_code={AN:"Andaman and Nicobar",AP:"Andhra Pradesh",AR:"Arunachal Pradesh",AS:"Assam",BR:"Bihar",TT:"Total",CH:"Chandigarh",CT:"Chattisgarh",DL:"Delhi",DN:"Dadra and Nagar Haveli",GA:"Goa",GJ:"Gujarat",HP:"Himachal Pradesh",HR:"Haryana",JH:"Jharkhand",JK:"Jammu and Kashmir",KA:"Karnataka",KL:"Kerala",LA:"Ladakh",LD:"Lakshadweep",MH:"Maharashtra",ML:"Meghalaya",MN:"Manipur",MP:"Madhya Pradesh",MZ:"Mizoram",NL:"Nagaland",OR:"Odisha",PB:"Punjab",PY:"Puducherry",RJ:"Rajasthan",SK:"Sikkim",TG:"Telangana",TN:"Tamil Nadu",TR:"Tripura",UP:"Uttar Pradesh",UT:"Uttarakhand",WB:"West Bengal"};function plot_time_series_data(state,typeOfGraph,plotlyGraphDiv){var urls;urls="TT"==state?"https://api.covid19tracker.in/data/static/timeseries.min.json":"https://api.covid19tracker.in/data/static/timeseries/"+state+".min.json";let date_range=[],confirmed_cases=[],deceased_cases=[],recovered_cases=[],active_cases=[],filter,mode="lines";"Cummulative"==typeOfGraph?filter="total":"Daily"==typeOfGraph&&(filter="delta"),Plotly.d3.json(urls,(function(figure){let data=figure[state].dates;$.each(data,(function(item){date_range.push(item),confirmed_cases.push(data[item][filter].confirmed),deceased_cases.push(data[item][filter].deceased),recovered_cases.push(data[item][filter].recovered),active_cases.push(data[item][filter].confirmed-data[item][filter].recovered-data[item][filter].deceased)}));var trace1={x:date_range,y:confirmed_cases,marker:{color:"blue"},mode:mode,name:"Confirmed"},trace2={x:date_range,y:deceased_cases,xaxis:"x2",yaxis:"y2",marker:{color:"red"},mode:mode,name:"Deceased"},trace3={x:date_range,y:recovered_cases,xaxis:"x3",yaxis:"y3",marker:{color:"green"},mode:mode,name:"Recovered"},trace4={x:date_range,y:active_cases,xaxis:"x4",yaxis:"y4",marker:{color:"#f05be8"},mode:mode,name:"Active"},layout={grid:{rows:2,columns:2,pattern:"independent"},title:"COVID-19 | India ("+typeOfGraph+")"},config={responsive:!0,displayModeBar:!1};Plotly.react(plotlyGraphDiv,[trace1,trace2,trace3,trace4],layout,config)}))}function sort_and_store(state_data,state_names,total_confirmed,total_active,total_recovered){state_data.sort((function(a,b){return a[1]<b[1]?1:a[1]>b[1]?-1:0}));for(var i=0;i<state_data.length;i++)state_names.push(state_data[i][0]),total_confirmed.push(state_data[i][1]),total_active.push(state_data[i][2]),total_recovered.push(state_data[i][3]);states_bar_chart(state_names,total_confirmed,total_active,total_recovered)}function fetch_data(){$.getJSON(url,(function(data){var updated_date=data.TT.meta.last_updated;x=updated_date.split("T"),$(".updated_date").text(moment(updated_date).format("MMMM Do YYYY, h:mm:ss a")+" (IST)");var state_data=[];$.each(data,(function(item){var total=data[item].total;"TT"!=item&&state_data.push([state_code[item],total.confirmed,Math.abs(total.confirmed-total.deceased-total.recovered),total.recovered]);var confirmed=total.confirmed.toLocaleString("en-IN"),deceased=total.deceased.toLocaleString("en-IN"),recovered=total.recovered.toLocaleString("en-IN"),tested=total.tested.toLocaleString("en-IN"),total_vaccinated=(total.vaccinated1+total.vaccinated2).toLocaleString("en-IN"),active=Math.abs(total.confirmed-total.deceased-total.recovered),today_confirmed=0,today_deceased=0,today_recovered=0,today_vaccinated=0;if(data[item].delta&&(today_confirmed=null==data[item].delta.confirmed?0:data[item].delta.confirmed.toLocaleString("en-IN"),today_deceased=null==data[item].delta.deceased?0:data[item].delta.deceased.toLocaleString("en-IN"),today_recovered=null==data[item].delta.recovered?0:data[item].delta.recovered.toLocaleString("en-IN"),today_vaccinated=null==data[item].delta.vaccinated?0:data[item].delta.vaccinated.toLocaleString("en-IN")),"TT"!=item)var row='<tr><td><a class="state_name" href="'+item+'">'+state_code[item]+" ("+item+")</a></td><td>"+confirmed+'<small class="confirmed">(+'+today_confirmed+")</small><td>"+active.toLocaleString("en-IN")+"</td></td><td>"+deceased+'<small class="deceased">(+'+today_deceased+")</small></td><td>"+recovered+'<small class="recovered">(+'+today_recovered+")</small></td><td>"+tested+"</td><td>"+total_vaccinated+'<small class="vaccinated">(+'+today_vaccinated+")</small></td></tr>";$(".main_table").append(row)}));var today_confirmed=null==data.TT.delta.confirmed?0:data.TT.delta.confirmed.toLocaleString("en-IN"),today_deceased=null==data.TT.delta.deceased?0:data.TT.delta.deceased.toLocaleString("en-IN"),today_recovered=null==data.TT.delta.recovered?0:data.TT.delta.recovered.toLocaleString("en-IN"),today_vaccinated=null==data.TT.delta.vaccinated?0:data.TT.delta.vaccinated.toLocaleString("en-IN"),today_tested=null==data.TT.delta.tested?0:data.TT.delta.tested.toLocaleString("en-IN"),today_active=Math.abs(data.TT.total.confirmed-data.TT.total.deceased-data.TT.total.recovered-data.TT.total.other),TT_total_vaccines=(data.TT.total.vaccinated1+data.TT.total.vaccinated2).toLocaleString("en-IN"),TT_confirmed=data.TT.total.confirmed.toLocaleString("en-IN"),TT_deceased=data.TT.total.deceased.toLocaleString("en-IN"),TT_recovered=data.TT.total.recovered.toLocaleString("en-IN"),TT_tested=data.TT.total.tested.toLocaleString("en-IN"),TT_vaccinated_1=data.TT.total.vaccinated1.toLocaleString("en-IN"),TT_vaccinated_2=data.TT.total.vaccinated2.toLocaleString("en-IN"),TT_population=data.TT.meta.population,TT_vaccine1_percentage=Math.round(data.TT.total.vaccinated1/TT_population*100),TT_vaccine2_percentage=Math.round(data.TT.total.vaccinated2/TT_population*100),TT_active=Math.abs(data.TT.total.confirmed-data.TT.total.deceased-data.TT.total.recovered-data.TT.total.other),row='<tr style="background-color: lightyellow; font-weight: 700;"><td><a class="sticky-col first-col">'+state_code.TT+" (TT)</a></td><td>"+TT_confirmed+'<small class="confirmed">(+'+today_confirmed+")</small></td><td>"+TT_active.toLocaleString("en-IN")+"</td><td>"+TT_deceased+'<small class="deceased">(+'+today_deceased+")</small></td><td>"+TT_recovered+'<small class="recovered">(+'+today_recovered+")</small></td><td>"+TT_tested+' <small class="tested">(+'+today_tested+")</small></td><td>"+TT_total_vaccines+'<small style="color: blue;">(+'+today_vaccinated+")</small></td></tr>";$(".main_table").append(row);var prev_day=data.TT.delta;null!=prev_day?($(".confirmed_24 > h3").text(TT_confirmed),$(".confirmed_24 > small").text("(+"+prev_day.confirmed.toLocaleString("en-IN")+")"),$(".deceased_24 > h3").text(TT_deceased),$(".deceased_24 > small").text("(+"+prev_day.deceased.toLocaleString("en-IN")+")"),$(".recovered_24 > h3").text(TT_recovered),$(".recovered_24 > small").text("(+"+prev_day.recovered.toLocaleString("en-IN")+")"),$(".active_24 > h3").text(TT_active.toLocaleString("en-IN"))):($(".confirmed_24 > h3").text(TT_confirmed),$(".deceased_24 > h3").text(TT_deceased),$(".recovered_24 > h3").text(TT_recovered),$(".active_24 > h3").text(TT_active.toLocaleString("en-IN"))),$(".total_doses").text(TT_total_vaccines),$("#first_dose_count").text(TT_vaccinated_1),$("#first_dose_progress").attr({"aria-valuenow":TT_vaccine1_percentage}),$("#first_dose_progress").css("width",TT_vaccine1_percentage+"%"),$("#first_dose_progress").text(TT_vaccine1_percentage+"%"),$("#second_dose_count").text(TT_vaccinated_2),$("#second_dose_progress").attr({"aria-valuenow":TT_vaccine2_percentage}),$("#second_dose_progress").css("width",TT_vaccine2_percentage+"%"),$("#second_dose_progress").text(TT_vaccine2_percentage+"%"),stop_loading(),sort_and_store(state_data,state_names,total_confirmed,total_active,total_recovered)})),$(".footer > small").text("Source: "+url)}function total_pie_chart(recovered,deceased,active){var data=[{values:[recovered,deceased,active],labels:["Recovered","Deceased","Active"],type:"pie"}],layout={height:400,width:500,title:"India Cases",autosize:!0};Plotly.newPlot("totalPieDiv",data,layout)}function states_bar_chart(state_names,total_confirmed,total_active){var trace1,trace2,trace3,data=[{x:state_names,y:total_confirmed,type:"bar",name:"Confirmed",marker:{color:"rgb(10, 228, 240)",opacity:.7}},{x:state_names,y:total_recovered,type:"bar",name:"Recovered",marker:{color:"rgb(22, 111, 3)",opacity:.5}},{x:state_names,y:total_active,type:"bar",name:"Active",marker:{color:"rgb(252, 111, 3)",opacity:.5}}],layout={title:"State wise Data",xaxis:{tickangle:-45},barmode:"group"},config={responsive:!0,displayModeBar:!1};Plotly.react("totalBarDiv",data,layout,config)}fetch_data(),plot_time_series_data("TT","Cummulative","totalDiv"),plot_time_series_data("TT","Daily","dailyDiv")}));